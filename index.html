<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Minecraft Phase 9: Physics & Features Restored</title>
<style>
  body { margin: 0; overflow: hidden; background: #87ceeb; font-family: monospace; user-select: none; }
  
  #game-ui { visibility: hidden; }
  
  #crosshair {
    position: fixed; top: 50%; left: 50%; width: 10px; height: 10px;
    margin-left: -5px; margin-top: -5px; border: 2px solid white; pointer-events: none; z-index: 10;
  }

  #ui-container {
    position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); text-align: center; pointer-events: none;
  }

  /* LOADING SCREEN */
  #loading-screen {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #222; z-index: 100;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
  }
  #loading-text { color: white; font-size: 20px; margin-bottom: 20px; font-weight: bold; }
  #progress-bar-box { width: 300px; height: 30px; border: 3px solid white; padding: 2px; }
  #progress-bar { width: 0%; height: 100%; background: #4caf50; transition: width 0.1s; }

  /* HOTBAR */
  #hotbar { display: flex; gap: 4px; justify-content: center; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 5px; }
  .slot {
    width: 44px; height: 44px; background: #8b8b8b; border: 3px solid #373737;
    display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative;
  }
  .slot.selected { background: #bbb; border-color: white; }
  .slot-icon { width: 32px; height: 32px; image-rendering: pixelated; }
  .key-bind { position: absolute; top: 2px; left: 2px; font-size: 10px; color: #444; font-weight: bold; }
  .count { position: absolute; bottom: 2px; right: 2px; font-size: 12px; color: white; text-shadow: 1px 1px 0 #000; }
  
  #debug-info { position: fixed; top: 10px; left: 10px; color: white; text-shadow: 1px 1px 0 #000; }
</style>
</head>
<body>

<div id="loading-screen">
  <div id="loading-text">GENERATING WORLD... 0%</div>
  <div id="progress-bar-box"><div id="progress-bar"></div></div>
</div>

<div id="debug-info">WASD to Move | SPACE to Jump | F to Fly | SHIFT Sprint | HOLD CLICK to Mine</div>

<div id="game-ui">
  <div id="crosshair"></div>
  <div id="ui-container"><div id="hotbar"></div></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
// --- CONFIGURATION ---
const RENDER_DISTANCE = 8; // Radius of chunks to keep loaded
const SPEED_WALK = 0.1;
const SPEED_SPRINT = 0.17;
const SPEED_FLY = 0.4;
const JUMP_FORCE = 0.25;
const GRAVITY = 0.018;
const PLAYER_HEIGHT = 1.6;

// --- SCENE SETUP ---
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);
scene.fog = new THREE.Fog(0x87ceeb, 20, 60);

const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
scene.add(ambientLight);
const dirLight = new THREE.DirectionalLight(0xffffff, 0.7);
dirLight.position.set(50, 100, 50);
scene.add(dirLight);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.rotation.order = "YXZ";

const renderer = new THREE.WebGLRenderer({ antialias: false });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(1);
document.body.appendChild(renderer.domElement);

// --- TEXTURES ---
const textureCanvas = document.createElement("canvas");
textureCanvas.width = 16; textureCanvas.height = 16;
const ctx = textureCanvas.getContext("2d");

function createTexture(drawFn) {
  ctx.clearRect(0,0,16,16);
  drawFn(ctx);
  const dataUrl = textureCanvas.toDataURL();
  const copy = document.createElement("canvas");
  copy.width=16; copy.height=16;
  copy.getContext("2d").drawImage(textureCanvas,0,0);
  const tex = new THREE.CanvasTexture(copy);
  tex.magFilter = THREE.NearestFilter;
  tex.colorSpace = THREE.SRGBColorSpace;
  return { tex: tex, icon: dataUrl };
}

function noise(ctx, colors) {
  for(let i=0; i<256; i++) {
    ctx.fillStyle = colors[Math.floor(Math.random()*colors.length)];
    ctx.fillRect(i%16, Math.floor(i/16), 1, 1);
  }
}

// Blocks
const tGrassTop = createTexture(c => noise(c, ["#4caf50", "#388e3c"]));
const tGrassSide = createTexture(c => { noise(c, ["#795548", "#5d4037"]); c.fillStyle="#4caf50"; c.fillRect(0,0,16,4); });
const tDirt = createTexture(c => noise(c, ["#795548", "#5d4037"]));
const tStone = createTexture(c => noise(c, ["#9e9e9e", "#757575"]));
const tWood = createTexture(c => { noise(c, ["#5d4037", "#4e342e"]); c.fillStyle="#3e2723"; c.fillRect(4,0,2,16); c.fillRect(10,0,2,16); });
const tLeaves = createTexture(c => noise(c, ["#2e7d32", "#1b5e20", "#4caf50"]));
const tDiamond = createTexture(c => { noise(c, ["#9e9e9e"]); c.fillStyle="#00bcd4"; c.fillRect(6,6,4,4); });
// Tools
const tPickaxe = createTexture(c => { c.fillStyle="#555"; c.fillRect(4,4,8,2); c.fillStyle="#8d6e63"; c.fillRect(7,6,2,8); });

const matGrass = [tGrassSide.tex, tGrassSide.tex, tGrassTop.tex, tDirt.tex, tGrassSide.tex, tGrassSide.tex].map(t => new THREE.MeshLambertMaterial({map:t}));
const matStone = new THREE.MeshLambertMaterial({map:tStone.tex});
const matWood = new THREE.MeshLambertMaterial({map:tWood.tex});
const matLeaves = new THREE.MeshLambertMaterial({map:tLeaves.tex});
const matDiamond = new THREE.MeshLambertMaterial({map:tDiamond.tex});
const matBedrock = new THREE.MeshLambertMaterial({color: 0x111111});

const MATERIALS = [matGrass, matStone, matWood, matLeaves, matBedrock, matDiamond];
// HP: How long to hold click
const BLOCK_HP = { 0: 20, 1: 60, 2: 40, 3: 10, 4: 999999, 5: 100 };

const INV = [
  { name: "Grass", id: 0, icon: tGrassSide.icon },
  { name: "Stone", id: 1, icon: tStone.icon },
  { name: "Wood", id: 2, icon: tWood.icon },
  { name: "Leaves", id: 3, icon: tLeaves.icon },
  { name: "Diamond", id: 5, icon: tDiamond.icon },
  { name: "Pickaxe", id: 99, icon: tPickaxe.icon } // 99 = Tool
];

let inventory = [0,0,0,0,0,0,0,0,1]; // Counts
let selectedSlot = 0;

// Setup UI
const hotbar = document.getElementById("hotbar");
for(let i=0; i<9; i++) {
  const item = INV[i % INV.length];
  hotbar.innerHTML += `
    <div
